{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import 'dotenv/config';\r\nimport express from 'express';\r\nimport cors from 'cors';\r\nimport helmet from 'helmet';\r\nimport rateLimit from 'express-rate-limit';\r\nimport pino from 'pino';\r\nimport swaggerUi from 'swagger-ui-express';\r\nimport swaggerJSDoc from 'swagger-jsdoc';\r\nimport jwt from 'jsonwebtoken';\r\nimport { createClient } from '@supabase/supabase-js';\r\n\r\n// Logger\r\nconst logger = pino({ transport: process.env.NODE_ENV !== 'production' ? { target: 'pino-pretty' } : undefined });\r\n\r\n// Env\r\nconst PORT = Number(process.env.PORT || 4000);\r\nconst CORS_ORIGINS = (process.env.CORS_ORIGINS || '').split(',').map(s => s.trim()).filter(Boolean);\r\nconst SUPABASE_URL = process.env.SUPABASE_URL as string;\r\nconst SUPABASE_SERVICE_ROLE_KEY = process.env.SUPABASE_SERVICE_ROLE_KEY as string;\r\nconst ADMIN_JWT_SECRET = process.env.ADMIN_JWT_SECRET as string;\r\n\r\nif (!SUPABASE_URL || !SUPABASE_SERVICE_ROLE_KEY) {\r\n  logger.warn('Supabase admin env not set. Set SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY.');\r\n}\r\nif (!ADMIN_JWT_SECRET) {\r\n  logger.warn('ADMIN_JWT_SECRET is not set. Admin auth will fail.');\r\n}\r\n\r\n// Supabase admin client\r\nexport const supabaseAdmin = createClient(SUPABASE_URL || '', SUPABASE_SERVICE_ROLE_KEY || '', {\r\n  auth: { persistSession: false, autoRefreshToken: false },\r\n});\r\n\r\n// Swagger setup\r\nconst swaggerSpec = swaggerJSDoc({\r\n  definition: {\r\n    openapi: '3.0.3',\r\n    info: {\r\n      title: 'LinguaLink Admin API',\r\n      version: '1.0.0',\r\n      description: 'Admin API for LinguaLink platform management including user moderation, role management, and analytics'\r\n    },\r\n    servers: [{ url: `http://localhost:${PORT}` }],\r\n    components: {\r\n      securitySchemes: {\r\n        bearerAuth: { type: 'http', scheme: 'bearer', bearerFormat: 'JWT' },\r\n      },\r\n      schemas: {\r\n        User: {\r\n          type: 'object',\r\n          properties: {\r\n            id: { type: 'string', format: 'uuid' },\r\n            username: { type: 'string' },\r\n            email: { type: 'string', format: 'email' },\r\n            country: { type: 'string' },\r\n            state: { type: 'string' },\r\n            city: { type: 'string' },\r\n            lga: { type: 'string' },\r\n            created_at: { type: 'string', format: 'date-time' },\r\n            updated_at: { type: 'string', format: 'date-time' },\r\n            referral_code: { type: 'string' },\r\n            is_banned: { type: 'boolean' },\r\n            admin_roles: { type: 'array', items: { type: 'string' } },\r\n            language_roles: { type: 'object' },\r\n            referral_count: { type: 'integer' }\r\n          }\r\n        },\r\n        Pagination: {\r\n          type: 'object',\r\n          properties: {\r\n            page: { type: 'integer' },\r\n            limit: { type: 'integer' },\r\n            total: { type: 'integer' },\r\n            pages: { type: 'integer' }\r\n          }\r\n        },\r\n        AdminAction: {\r\n          type: 'object',\r\n          properties: {\r\n            id: { type: 'string', format: 'uuid' },\r\n            admin_id: { type: 'string', format: 'uuid' },\r\n            action: { type: 'string' },\r\n            target_user_id: { type: 'string', format: 'uuid' },\r\n            details: { type: 'object' },\r\n            created_at: { type: 'string', format: 'date-time' }\r\n          }\r\n        }\r\n      }\r\n    },\r\n    security: [{ bearerAuth: [] }],\r\n  },\r\n  apis: ['./src/index.ts'],\r\n});\r\n\r\n// Express app\r\nconst app = express();\r\n\r\napp.use(express.json());\r\napp.use(express.urlencoded({ extended: false }));\r\napp.use(helmet());\r\napp.use(cors({ origin: CORS_ORIGINS.length ? CORS_ORIGINS : true }));\r\napp.set('trust proxy', 1);\r\n\r\n// Rate limiter\r\nconst limiter = rateLimit({ windowMs: 60_000, max: 120 });\r\napp.use(limiter);\r\n\r\n/**\r\n * @swagger\r\n * /health:\r\n *   get:\r\n *     summary: Health check endpoint\r\n *     description: Returns the health status of the API\r\n *     tags: [System]\r\n *     responses:\r\n *       200:\r\n *         description: API is healthy\r\n *         content:\r\n *           application/json:\r\n *             schema:\r\n *               type: object\r\n *               properties:\r\n *                 ok:\r\n *                   type: boolean\r\n *                 uptime:\r\n *                   type: number\r\n */\r\napp.get('/health', (_req, res) => {\r\n  res.json({ ok: true, uptime: process.uptime() });\r\n});\r\n\r\n// Swagger UI (protect in prod if desired)\r\napp.use('/docs', swaggerUi.serve, swaggerUi.setup(swaggerSpec));\r\n\r\n// Admin guard middleware\r\nfunction adminGuard(req: express.Request, res: express.Response, next: express.NextFunction) {\r\n  try {\r\n    const header = req.headers.authorization || '';\r\n    const token = header.startsWith('Bearer ') ? header.slice(7) : undefined;\r\n    if (!token) return res.status(401).json({ error: 'Missing token' });\r\n    const payload = jwt.verify(token, ADMIN_JWT_SECRET) as { sub?: string; role?: string };\r\n    if (!payload || (payload.role !== 'admin' && payload.role !== 'superadmin')) {\r\n      return res.status(403).json({ error: 'Forbidden' });\r\n    }\r\n    (req as any).admin = payload;\r\n    next();\r\n  } catch (e: any) {\r\n    return res.status(401).json({ error: 'Invalid token' });\r\n  }\r\n}\r\n\r\n// ===== USER MANAGEMENT ENDPOINTS =====\r\n\r\n/**\r\n * @swagger\r\n * /admin/users:\r\n *   get:\r\n *     summary: Get all users with filters\r\n *     description: Retrieve a paginated list of users with optional filtering\r\n *     tags: [Users]\r\n *     security:\r\n *       - bearerAuth: []\r\n *     parameters:\r\n *       - in: query\r\n *         name: page\r\n *         schema:\r\n *           type: integer\r\n *           default: 1\r\n *         description: Page number\r\n *       - in: query\r\n *         name: limit\r\n *         schema:\r\n *           type: integer\r\n *           default: 20\r\n *         description: Number of users per page\r\n *       - in: query\r\n *         name: banned\r\n *         schema:\r\n *           type: boolean\r\n *         description: Filter by banned status\r\n *       - in: query\r\n *         name: role\r\n *         schema:\r\n *           type: string\r\n *         description: Filter by admin role\r\n *       - in: query\r\n *         name: country\r\n *         schema:\r\n *           type: string\r\n *         description: Filter by country\r\n *       - in: query\r\n *         name: search\r\n *         schema:\r\n *           type: string\r\n *         description: Search by username or email\r\n *     responses:\r\n *       200:\r\n *         description: List of users with pagination\r\n *         content:\r\n *           application/json:\r\n *             schema:\r\n *               type: object\r\n *               properties:\r\n *                 users:\r\n *                   type: array\r\n *                   items:\r\n *                     $ref: '#/components/schemas/User'\r\n *                 pagination:\r\n *                   $ref: '#/components/schemas/Pagination'\r\n *       401:\r\n *         description: Unauthorized\r\n *       500:\r\n *         description: Internal server error\r\n */\r\napp.get('/admin/users', adminGuard, async (req, res) => {\r\n  try {\r\n    const { page = 1, limit = 20, banned, role, country, search } = req.query;\r\n    const offset = (Number(page) - 1) * Number(limit);\r\n\r\n    let query = supabaseAdmin\r\n      .from('profiles')\r\n      .select(`\r\n        id,\r\n        username,\r\n        email,\r\n        country,\r\n        state,\r\n        city,\r\n        lga,\r\n        created_at,\r\n        updated_at,\r\n        referral_code,\r\n        is_banned,\r\n        admin_roles,\r\n        language_roles\r\n      `, { count: 'exact' });\r\n\r\n    // Apply filters\r\n    if (banned !== undefined) {\r\n      query = query.eq('is_banned', banned === 'true');\r\n    }\r\n    if (role) {\r\n      query = query.contains('admin_roles', [role]);\r\n    }\r\n    if (country) {\r\n      query = query.eq('country', country);\r\n    }\r\n    if (search) {\r\n      query = query.or(`username.ilike.%${search}%,email.ilike.%${search}%`);\r\n    }\r\n\r\n    const { data: users, error, count } = await query\r\n      .range(offset, offset + Number(limit) - 1)\r\n      .order('created_at', { ascending: false });\r\n\r\n    if (error) {\r\n      logger.error({ err: error }, 'Error fetching users');\r\n      return res.status(500).json({ error: 'Failed to fetch users' });\r\n    }\r\n\r\n    res.json({\r\n      users: users || [],\r\n      pagination: {\r\n        page: Number(page),\r\n        limit: Number(limit),\r\n        total: count || 0,\r\n        pages: Math.ceil((count || 0) / Number(limit))\r\n      }\r\n    });\r\n  } catch (error) {\r\n    logger.error({ err: error }, 'Unexpected error in /admin/users');\r\n    res.status(500).json({ error: 'Internal server error' });\r\n  }\r\n});\r\n\r\n// Get specific user details\r\napp.get('/admin/users/:id', adminGuard, async (req, res) => {\r\n  try {\r\n    const { id } = req.params;\r\n\r\n    const { data: user, error } = await supabaseAdmin\r\n      .from('profiles')\r\n      .select(`\r\n        id,\r\n        username,\r\n        email,\r\n        country,\r\n        state,\r\n        city,\r\n        lga,\r\n        created_at,\r\n        updated_at,\r\n        referral_code,\r\n        is_banned,\r\n        admin_roles,\r\n        language_roles,\r\n        referral_count\r\n      `)\r\n      .eq('id', id)\r\n      .single();\r\n\r\n    if (error) {\r\n      if (error.code === 'PGRST116') {\r\n        return res.status(404).json({ error: 'User not found' });\r\n      }\r\n      logger.error({ err: error }, 'Error fetching user');\r\n      return res.status(500).json({ error: 'Failed to fetch user' });\r\n    }\r\n\r\n    res.json({ user });\r\n  } catch (error) {\r\n    logger.error({ err: error }, 'Unexpected error in /admin/users/:id');\r\n    res.status(500).json({ error: 'Internal server error' });\r\n  }\r\n});\r\n\r\n/**\r\n * @swagger\r\n * /admin/users/{id}/ban:\r\n *   post:\r\n *     summary: Ban a user\r\n *     description: Ban a user from the platform\r\n *     tags: [Users]\r\n *     security:\r\n *       - bearerAuth: []\r\n *     parameters:\r\n *       - in: path\r\n *         name: id\r\n *         required: true\r\n *         schema:\r\n *           type: string\r\n *           format: uuid\r\n *         description: User ID to ban\r\n *     requestBody:\r\n *       required: false\r\n *       content:\r\n *         application/json:\r\n *           schema:\r\n *             type: object\r\n *             properties:\r\n *               reason:\r\n *                 type: string\r\n *                 description: Reason for banning the user\r\n *     responses:\r\n *       200:\r\n *         description: User banned successfully\r\n *       400:\r\n *         description: User already banned\r\n *       404:\r\n *         description: User not found\r\n *       401:\r\n *         description: Unauthorized\r\n *       500:\r\n *         description: Internal server error\r\n */\r\napp.post('/admin/users/:id/ban', adminGuard, async (req, res) => {\r\n  try {\r\n    const { id } = req.params;\r\n    const { reason } = req.body;\r\n\r\n    const { data: user, error: fetchError } = await supabaseAdmin\r\n      .from('profiles')\r\n      .select('id, username, is_banned')\r\n      .eq('id', id)\r\n      .single();\r\n\r\n    if (fetchError) {\r\n      if (fetchError.code === 'PGRST116') {\r\n        return res.status(404).json({ error: 'User not found' });\r\n      }\r\n      return res.status(500).json({ error: 'Failed to fetch user' });\r\n    }\r\n\r\n    if (user.is_banned) {\r\n      return res.status(400).json({ error: 'User is already banned' });\r\n    }\r\n\r\n    const { error: updateError } = await supabaseAdmin\r\n      .from('profiles')\r\n      .update({\r\n        is_banned: true,\r\n        ban_reason: reason,\r\n        banned_at: new Date().toISOString()\r\n      })\r\n      .eq('id', id);\r\n\r\n    if (updateError) {\r\n      logger.error({ err: updateError }, 'Error banning user');\r\n      return res.status(500).json({ error: 'Failed to ban user' });\r\n    }\r\n\r\n    // Log admin action\r\n    await supabaseAdmin\r\n      .from('admin_actions')\r\n      .insert({\r\n        admin_id: (req as any).admin?.sub,\r\n        action: 'ban_user',\r\n        target_user_id: id,\r\n        details: { reason },\r\n        created_at: new Date().toISOString()\r\n      });\r\n\r\n    res.json({ message: 'User banned successfully' });\r\n  } catch (error) {\r\n    logger.error({ err: error }, 'Unexpected error in /admin/users/:id/ban');\r\n    res.status(500).json({ error: 'Internal server error' });\r\n  }\r\n});\r\n\r\n// Unban user\r\napp.post('/admin/users/:id/unban', adminGuard, async (req, res) => {\r\n  try {\r\n    const { id } = req.params;\r\n\r\n    const { data: user, error: fetchError } = await supabaseAdmin\r\n      .from('profiles')\r\n      .select('id, username, is_banned')\r\n      .eq('id', id)\r\n      .single();\r\n\r\n    if (fetchError) {\r\n      if (fetchError.code === 'PGRST116') {\r\n        return res.status(404).json({ error: 'User not found' });\r\n      }\r\n      return res.status(500).json({ error: 'Failed to fetch user' });\r\n    }\r\n\r\n    if (!user.is_banned) {\r\n      return res.status(400).json({ error: 'User is not banned' });\r\n    }\r\n\r\n    const { error: updateError } = await supabaseAdmin\r\n      .from('profiles')\r\n      .update({\r\n        is_banned: false,\r\n        ban_reason: null,\r\n        banned_at: null\r\n      })\r\n      .eq('id', id);\r\n\r\n    if (updateError) {\r\n      logger.error({ err: updateError }, 'Error unbanning user');\r\n      return res.status(500).json({ error: 'Failed to unban user' });\r\n    }\r\n\r\n    // Log admin action\r\n    await supabaseAdmin\r\n      .from('admin_actions')\r\n      .insert({\r\n        admin_id: (req as any).admin?.sub,\r\n        action: 'unban_user',\r\n        target_user_id: id,\r\n        details: {},\r\n        created_at: new Date().toISOString()\r\n      });\r\n\r\n    res.json({ message: 'User unbanned successfully' });\r\n  } catch (error) {\r\n    logger.error({ err: error }, 'Unexpected error in /admin/users/:id/unban');\r\n    res.status(500).json({ error: 'Internal server error' });\r\n  }\r\n});\r\n\r\n// Promote user to admin\r\napp.post('/admin/users/:id/promote', adminGuard, async (req, res) => {\r\n  try {\r\n    const { id } = req.params;\r\n    const { role = 'admin' } = req.body;\r\n\r\n    if (!['admin', 'superadmin'].includes(role)) {\r\n      return res.status(400).json({ error: 'Invalid role. Must be admin or superadmin' });\r\n    }\r\n\r\n    const { data: user, error: fetchError } = await supabaseAdmin\r\n      .from('profiles')\r\n      .select('id, username, admin_roles')\r\n      .eq('id', id)\r\n      .single();\r\n\r\n    if (fetchError) {\r\n      if (fetchError.code === 'PGRST116') {\r\n        return res.status(404).json({ error: 'User not found' });\r\n      }\r\n      return res.status(500).json({ error: 'Failed to fetch user' });\r\n    }\r\n\r\n    const currentRoles = user.admin_roles || [];\r\n    if (currentRoles.includes(role)) {\r\n      return res.status(400).json({ error: `User already has ${role} role` });\r\n    }\r\n\r\n    const { error: updateError } = await supabaseAdmin\r\n      .from('profiles')\r\n      .update({\r\n        admin_roles: [...currentRoles, role]\r\n      })\r\n      .eq('id', id);\r\n\r\n    if (updateError) {\r\n      logger.error({ err: updateError }, 'Error promoting user');\r\n      return res.status(500).json({ error: 'Failed to promote user' });\r\n    }\r\n\r\n    // Log admin action\r\n    await supabaseAdmin\r\n      .from('admin_actions')\r\n      .insert({\r\n        admin_id: (req as any).admin?.sub,\r\n        action: 'promote_user',\r\n        target_user_id: id,\r\n        details: { role },\r\n        created_at: new Date().toISOString()\r\n      });\r\n\r\n    res.json({ message: `User promoted to ${role} successfully` });\r\n  } catch (error) {\r\n    logger.error({ err: error }, 'Unexpected error in /admin/users/:id/promote');\r\n    res.status(500).json({ error: 'Internal server error' });\r\n  }\r\n});\r\n\r\n// Demote user from admin\r\napp.post('/admin/users/:id/demote', adminGuard, async (req, res) => {\r\n  try {\r\n    const { id } = req.params;\r\n    const { role = 'admin' } = req.body;\r\n\r\n    const { data: user, error: fetchError } = await supabaseAdmin\r\n      .from('profiles')\r\n      .select('id, username, admin_roles')\r\n      .eq('id', id)\r\n      .single();\r\n\r\n    if (fetchError) {\r\n      if (fetchError.code === 'PGRST116') {\r\n        return res.status(404).json({ error: 'User not found' });\r\n      }\r\n      return res.status(500).json({ error: 'Failed to fetch user' });\r\n    }\r\n\r\n    const currentRoles = user.admin_roles || [];\r\n    if (!currentRoles.includes(role)) {\r\n      return res.status(400).json({ error: `User does not have ${role} role` });\r\n    }\r\n\r\n    const { error: updateError } = await supabaseAdmin\r\n      .from('profiles')\r\n      .update({\r\n        admin_roles: currentRoles.filter((r: string) => r !== role)\r\n      })\r\n      .eq('id', id);\r\n\r\n    if (updateError) {\r\n      logger.error({ err: updateError }, 'Error demoting user');\r\n      return res.status(500).json({ error: 'Failed to demote user' });\r\n    }\r\n\r\n    // Log admin action\r\n    await supabaseAdmin\r\n      .from('admin_actions')\r\n      .insert({\r\n        admin_id: (req as any).admin?.sub,\r\n        action: 'demote_user',\r\n        target_user_id: id,\r\n        details: { role },\r\n        created_at: new Date().toISOString()\r\n      });\r\n\r\n    res.json({ message: `User demoted from ${role} successfully` });\r\n  } catch (error) {\r\n    logger.error({ err: error }, 'Unexpected error in /admin/users/:id/demote');\r\n    res.status(500).json({ error: 'Internal server error' });\r\n  }\r\n});\r\n\r\n// ===== LANGUAGE ROLE MANAGEMENT ENDPOINTS =====\r\n\r\n// Grant validator role for specific language\r\napp.post('/admin/users/:id/roles/validator', adminGuard, async (req, res) => {\r\n  try {\r\n    const { id } = req.params;\r\n    const { language } = req.body;\r\n\r\n    if (!language) {\r\n      return res.status(400).json({ error: 'Language is required' });\r\n    }\r\n\r\n    const { data: user, error: fetchError } = await supabaseAdmin\r\n      .from('profiles')\r\n      .select('id, username, language_roles')\r\n      .eq('id', id)\r\n      .single();\r\n\r\n    if (fetchError) {\r\n      if (fetchError.code === 'PGRST116') {\r\n        return res.status(404).json({ error: 'User not found' });\r\n      }\r\n      return res.status(500).json({ error: 'Failed to fetch user' });\r\n    }\r\n\r\n    const currentRoles = user.language_roles || {};\r\n    if (currentRoles[language]?.includes('validator')) {\r\n      return res.status(400).json({ error: `User already has validator role for ${language}` });\r\n    }\r\n\r\n    const updatedRoles = {\r\n      ...currentRoles,\r\n      [language]: [...(currentRoles[language] || []), 'validator']\r\n    };\r\n\r\n    const { error: updateError } = await supabaseAdmin\r\n      .from('profiles')\r\n      .update({ language_roles: updatedRoles })\r\n      .eq('id', id);\r\n\r\n    if (updateError) {\r\n      logger.error({ err: updateError }, 'Error granting validator role');\r\n      return res.status(500).json({ error: 'Failed to grant validator role' });\r\n    }\r\n\r\n    // Log admin action\r\n    await supabaseAdmin\r\n      .from('admin_actions')\r\n      .insert({\r\n        admin_id: (req as any).admin?.sub,\r\n        action: 'grant_validator_role',\r\n        target_user_id: id,\r\n        details: { language },\r\n        created_at: new Date().toISOString()\r\n      });\r\n\r\n    res.json({ message: `Validator role granted for ${language} successfully` });\r\n  } catch (error) {\r\n    logger.error({ err: error }, 'Unexpected error in /admin/users/:id/roles/validator');\r\n    res.status(500).json({ error: 'Internal server error' });\r\n  }\r\n});\r\n\r\n// Grant ambassador role for specific language\r\napp.post('/admin/users/:id/roles/ambassador', adminGuard, async (req, res) => {\r\n  try {\r\n    const { id } = req.params;\r\n    const { language } = req.body;\r\n\r\n    if (!language) {\r\n      return res.status(400).json({ error: 'Language is required' });\r\n    }\r\n\r\n    const { data: user, error: fetchError } = await supabaseAdmin\r\n      .from('profiles')\r\n      .select('id, username, language_roles')\r\n      .eq('id', id)\r\n      .single();\r\n\r\n    if (fetchError) {\r\n      if (fetchError.code === 'PGRST116') {\r\n        return res.status(404).json({ error: 'User not found' });\r\n      }\r\n      return res.status(500).json({ error: 'Failed to fetch user' });\r\n    }\r\n\r\n    const currentRoles = user.language_roles || {};\r\n    if (currentRoles[language]?.includes('ambassador')) {\r\n      return res.status(400).json({ error: `User already has ambassador role for ${language}` });\r\n    }\r\n\r\n    const updatedRoles = {\r\n      ...currentRoles,\r\n      [language]: [...(currentRoles[language] || []), 'ambassador']\r\n    };\r\n\r\n    const { error: updateError } = await supabaseAdmin\r\n      .from('profiles')\r\n      .update({ language_roles: updatedRoles })\r\n      .eq('id', id);\r\n\r\n    if (updateError) {\r\n      logger.error({ err: updateError }, 'Error granting ambassador role');\r\n      return res.status(500).json({ error: 'Failed to grant ambassador role' });\r\n    }\r\n\r\n    // Log admin action\r\n    await supabaseAdmin\r\n      .from('admin_actions')\r\n      .insert({\r\n        admin_id: (req as any).admin?.sub,\r\n        action: 'grant_ambassador_role',\r\n        target_user_id: id,\r\n        details: { language },\r\n        created_at: new Date().toISOString()\r\n      });\r\n\r\n    res.json({ message: `Ambassador role granted for ${language} successfully` });\r\n  } catch (error) {\r\n    logger.error({ err: error }, 'Unexpected error in /admin/users/:id/roles/ambassador');\r\n    res.status(500).json({ error: 'Internal server error' });\r\n  }\r\n});\r\n\r\n// Revoke validator role\r\napp.delete('/admin/users/:id/roles/validator', adminGuard, async (req, res) => {\r\n  try {\r\n    const { id } = req.params;\r\n    const { language } = req.body;\r\n\r\n    if (!language) {\r\n      return res.status(400).json({ error: 'Language is required' });\r\n    }\r\n\r\n    const { data: user, error: fetchError } = await supabaseAdmin\r\n      .from('profiles')\r\n      .select('id, username, language_roles')\r\n      .eq('id', id)\r\n      .single();\r\n\r\n    if (fetchError) {\r\n      if (fetchError.code === 'PGRST116') {\r\n        return res.status(404).json({ error: 'User not found' });\r\n      }\r\n      return res.status(500).json({ error: 'Failed to fetch user' });\r\n    }\r\n\r\n    const currentRoles = user.language_roles || {};\r\n    if (!currentRoles[language]?.includes('validator')) {\r\n      return res.status(400).json({ error: `User does not have validator role for ${language}` });\r\n    }\r\n\r\n    const updatedRoles = {\r\n      ...currentRoles,\r\n      [language]: currentRoles[language].filter((role: string) => role !== 'validator')\r\n    };\r\n\r\n    const { error: updateError } = await supabaseAdmin\r\n      .from('profiles')\r\n      .update({ language_roles: updatedRoles })\r\n      .eq('id', id);\r\n\r\n    if (updateError) {\r\n      logger.error({ err: updateError }, 'Error revoking validator role');\r\n      return res.status(500).json({ error: 'Failed to revoke validator role' });\r\n    }\r\n\r\n    // Log admin action\r\n    await supabaseAdmin\r\n      .from('admin_actions')\r\n      .insert({\r\n        admin_id: (req as any).admin?.sub,\r\n        action: 'revoke_validator_role',\r\n        target_user_id: id,\r\n        details: { language },\r\n        created_at: new Date().toISOString()\r\n      });\r\n\r\n    res.json({ message: `Validator role revoked for ${language} successfully` });\r\n  } catch (error) {\r\n    logger.error({ err: error }, 'Unexpected error in /admin/users/:id/roles/validator');\r\n    res.status(500).json({ error: 'Internal server error' });\r\n  }\r\n});\r\n\r\n// Revoke ambassador role\r\napp.delete('/admin/users/:id/roles/ambassador', adminGuard, async (req, res) => {\r\n  try {\r\n    const { id } = req.params;\r\n    const { language } = req.body;\r\n\r\n    if (!language) {\r\n      return res.status(400).json({ error: 'Language is required' });\r\n    }\r\n\r\n    const { data: user, error: fetchError } = await supabaseAdmin\r\n      .from('profiles')\r\n      .select('id, username, language_roles')\r\n      .eq('id', id)\r\n      .single();\r\n\r\n    if (fetchError) {\r\n      if (fetchError.code === 'PGRST116') {\r\n        return res.status(404).json({ error: 'User not found' });\r\n      }\r\n      return res.status(500).json({ error: 'Failed to fetch user' });\r\n    }\r\n\r\n    const currentRoles = user.language_roles || {};\r\n    if (!currentRoles[language]?.includes('ambassador')) {\r\n      return res.status(400).json({ error: `User does not have ambassador role for ${language}` });\r\n    }\r\n\r\n    const updatedRoles = {\r\n      ...currentRoles,\r\n      [language]: currentRoles[language].filter((role: string) => role !== 'ambassador')\r\n    };\r\n\r\n    const { error: updateError } = await supabaseAdmin\r\n      .from('profiles')\r\n      .update({ language_roles: updatedRoles })\r\n      .eq('id', id);\r\n\r\n    if (updateError) {\r\n      logger.error({ err: updateError }, 'Error revoking ambassador role');\r\n      return res.status(500).json({ error: 'Failed to revoke ambassador role' });\r\n    }\r\n\r\n    // Log admin action\r\n    await supabaseAdmin\r\n      .from('admin_actions')\r\n      .insert({\r\n        admin_id: (req as any).admin?.sub,\r\n        action: 'revoke_ambassador_role',\r\n        target_user_id: id,\r\n        details: { language },\r\n        created_at: new Date().toISOString()\r\n      });\r\n\r\n    res.json({ message: `Ambassador role revoked for ${language} successfully` });\r\n  } catch (error) {\r\n    logger.error({ err: error }, 'Unexpected error in /admin/users/:id/roles/ambassador');\r\n    res.status(500).json({ error: 'Internal server error' });\r\n  }\r\n});\r\n\r\n// ===== STATISTICS ENDPOINTS =====\r\n\r\n/**\r\n * @swagger\r\n * /admin/stats/overview:\r\n *   get:\r\n *     summary: Get platform overview statistics\r\n *     description: Retrieve general platform statistics including user counts\r\n *     tags: [Statistics]\r\n *     security:\r\n *       - bearerAuth: []\r\n *     responses:\r\n *       200:\r\n *         description: Platform overview statistics\r\n *         content:\r\n *           application/json:\r\n *             schema:\r\n *               type: object\r\n *               properties:\r\n *                 totalUsers:\r\n *                   type: integer\r\n *                   description: Total number of users\r\n *                 activeUsers:\r\n *                   type: integer\r\n *                   description: Number of active (non-banned) users\r\n *                 bannedUsers:\r\n *                   type: integer\r\n *                   description: Number of banned users\r\n *                 recentUsers:\r\n *                   type: integer\r\n *                   description: Number of users created in last 30 days\r\n *                 timestamp:\r\n *                   type: string\r\n *                   format: date-time\r\n *       401:\r\n *         description: Unauthorized\r\n *       500:\r\n *         description: Internal server error\r\n */\r\napp.get('/admin/stats/overview', adminGuard, async (req, res) => {\r\n  try {\r\n    const { data: users, error: usersError } = await supabaseAdmin\r\n      .from('profiles')\r\n      .select('id, created_at, is_banned', { count: 'exact' });\r\n\r\n    if (usersError) {\r\n      logger.error({ err: usersError }, 'Error fetching user stats');\r\n      return res.status(500).json({ error: 'Failed to fetch user statistics' });\r\n    }\r\n\r\n    const totalUsers = users?.length || 0;\r\n    const bannedUsers = users?.filter(u => u.is_banned).length || 0;\r\n    const activeUsers = totalUsers - bannedUsers;\r\n\r\n    // Get users created in last 30 days\r\n    const thirtyDaysAgo = new Date();\r\n    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\r\n    const recentUsers = users?.filter(u => new Date(u.created_at) > thirtyDaysAgo).length || 0;\r\n\r\n    res.json({\r\n      totalUsers,\r\n      activeUsers,\r\n      bannedUsers,\r\n      recentUsers,\r\n      timestamp: new Date().toISOString()\r\n    });\r\n  } catch (error) {\r\n    logger.error({ err: error }, 'Unexpected error in /admin/stats/overview');\r\n    res.status(500).json({ error: 'Internal server error' });\r\n  }\r\n});\r\n\r\n// Language rankings\r\napp.get('/admin/stats/languages', adminGuard, async (req, res) => {\r\n  try {\r\n    const { data: users, error } = await supabaseAdmin\r\n      .from('profiles')\r\n      .select('language_roles');\r\n\r\n    if (error) {\r\n      logger.error({ err: error }, 'Error fetching language stats');\r\n      return res.status(500).json({ error: 'Failed to fetch language statistics' });\r\n    }\r\n\r\n    const languageCounts: Record<string, number> = {};\r\n\r\n    users?.forEach(user => {\r\n      if (user.language_roles) {\r\n        Object.keys(user.language_roles).forEach(language => {\r\n          languageCounts[language] = (languageCounts[language] || 0) + 1;\r\n        });\r\n      }\r\n    });\r\n\r\n    const languageRankings = Object.entries(languageCounts)\r\n      .map(([language, count]) => ({ language, count }))\r\n      .sort((a, b) => b.count - a.count);\r\n\r\n    res.json({\r\n      rankings: languageRankings,\r\n      timestamp: new Date().toISOString()\r\n    });\r\n  } catch (error) {\r\n    logger.error({ err: error }, 'Unexpected error in /admin/stats/languages');\r\n    res.status(500).json({ error: 'Internal server error' });\r\n  }\r\n});\r\n\r\n// Country rankings\r\napp.get('/admin/stats/countries', adminGuard, async (req, res) => {\r\n  try {\r\n    const { data: users, error } = await supabaseAdmin\r\n      .from('profiles')\r\n      .select('country')\r\n      .not('country', 'is', null);\r\n\r\n    if (error) {\r\n      logger.error({ err: error }, 'Error fetching country stats');\r\n      return res.status(500).json({ error: 'Failed to fetch country statistics' });\r\n    }\r\n\r\n    const countryCounts: Record<string, number> = {};\r\n\r\n    users?.forEach(user => {\r\n      if (user.country) {\r\n        countryCounts[user.country] = (countryCounts[user.country] || 0) + 1;\r\n      }\r\n    });\r\n\r\n    const countryRankings = Object.entries(countryCounts)\r\n      .map(([country, count]) => ({ country, count }))\r\n      .sort((a, b) => b.count - a.count);\r\n\r\n    res.json({\r\n      rankings: countryRankings,\r\n      timestamp: new Date().toISOString()\r\n    });\r\n  } catch (error) {\r\n    logger.error({ err: error }, 'Unexpected error in /admin/stats/countries');\r\n    res.status(500).json({ error: 'Internal server error' });\r\n  }\r\n});\r\n\r\n// User growth over time\r\napp.get('/admin/stats/growth', adminGuard, async (req, res) => {\r\n  try {\r\n    const { period = '30d' } = req.query;\r\n\r\n    let days = 30;\r\n    if (period === '7d') days = 7;\r\n    else if (period === '90d') days = 90;\r\n    else if (period === '1y') days = 365;\r\n\r\n    const { data: users, error } = await supabaseAdmin\r\n      .from('profiles')\r\n      .select('created_at')\r\n      .gte('created_at', new Date(Date.now() - days * 24 * 60 * 60 * 1000).toISOString())\r\n      .order('created_at', { ascending: true });\r\n\r\n    if (error) {\r\n      logger.error({ err: error }, 'Error fetching growth stats');\r\n      return res.status(500).json({ error: 'Failed to fetch growth statistics' });\r\n    }\r\n\r\n    // Group by day\r\n    const dailyGrowth: Record<string, number> = {};\r\n    users?.forEach(user => {\r\n      const date = user.created_at.split('T')[0];\r\n      dailyGrowth[date] = (dailyGrowth[date] || 0) + 1;\r\n    });\r\n\r\n    const growthData = Object.entries(dailyGrowth)\r\n      .map(([date, count]) => ({ date, count }))\r\n      .sort((a, b) => a.date.localeCompare(b.date));\r\n\r\n    res.json({\r\n      period,\r\n      growth: growthData,\r\n      totalNewUsers: users?.length || 0,\r\n      timestamp: new Date().toISOString()\r\n    });\r\n  } catch (error) {\r\n    logger.error({ err: error }, 'Unexpected error in /admin/stats/growth');\r\n    res.status(500).json({ error: 'Internal server error' });\r\n  }\r\n});\r\n\r\n// ===== AUDIT ENDPOINTS =====\r\n\r\n// Get admin actions\r\napp.get('/admin/audit/actions', adminGuard, async (req, res) => {\r\n  try {\r\n    const { page = 1, limit = 50, admin_id, action } = req.query;\r\n    const offset = (Number(page) - 1) * Number(limit);\r\n\r\n    let query = supabaseAdmin\r\n      .from('admin_actions')\r\n      .select(`\r\n        id,\r\n        admin_id,\r\n        action,\r\n        target_user_id,\r\n        details,\r\n        created_at\r\n      `, { count: 'exact' });\r\n\r\n    if (admin_id) {\r\n      query = query.eq('admin_id', admin_id);\r\n    }\r\n    if (action) {\r\n      query = query.eq('action', action);\r\n    }\r\n\r\n    const { data: actions, error, count } = await query\r\n      .range(offset, offset + Number(limit) - 1)\r\n      .order('created_at', { ascending: false });\r\n\r\n    if (error) {\r\n      logger.error({ err: error }, 'Error fetching admin actions');\r\n      return res.status(500).json({ error: 'Failed to fetch admin actions' });\r\n    }\r\n\r\n    res.json({\r\n      actions: actions || [],\r\n      pagination: {\r\n        page: Number(page),\r\n        limit: Number(limit),\r\n        total: count || 0,\r\n        pages: Math.ceil((count || 0) / Number(limit))\r\n      }\r\n    });\r\n  } catch (error) {\r\n    logger.error({ err: error }, 'Unexpected error in /admin/audit/actions');\r\n    res.status(500).json({ error: 'Internal server error' });\r\n  }\r\n});\r\n\r\n// Get audit trail for specific user\r\napp.get('/admin/audit/user/:id', adminGuard, async (req, res) => {\r\n  try {\r\n    const { id } = req.params;\r\n    const { page = 1, limit = 50 } = req.query;\r\n    const offset = (Number(page) - 1) * Number(limit);\r\n\r\n    const { data: actions, error, count } = await supabaseAdmin\r\n      .from('admin_actions')\r\n      .select(`\r\n        id,\r\n        admin_id,\r\n        action,\r\n        details,\r\n        created_at\r\n      `, { count: 'exact' })\r\n      .eq('target_user_id', id)\r\n      .range(offset, offset + Number(limit) - 1)\r\n      .order('created_at', { ascending: false });\r\n\r\n    if (error) {\r\n      logger.error({ err: error }, 'Error fetching user audit trail');\r\n      return res.status(500).json({ error: 'Failed to fetch user audit trail' });\r\n    }\r\n\r\n    res.json({\r\n      actions: actions || [],\r\n      pagination: {\r\n        page: Number(page),\r\n        limit: Number(limit),\r\n        total: count || 0,\r\n        pages: Math.ceil((count || 0) / Number(limit))\r\n      }\r\n    });\r\n  } catch (error) {\r\n    logger.error({ err: error }, 'Unexpected error in /admin/audit/user/:id');\r\n    res.status(500).json({ error: 'Internal server error' });\r\n  }\r\n});\r\n\r\n// Example protected route (keeping original for reference)\r\napp.get('/admin/overview', adminGuard, async (_req, res) => {\r\n  try {\r\n    // Simple sanity stats (can switch to MVs later)\r\n    const { count: usersCount } = await supabaseAdmin.from('profiles').select('id', { count: 'exact', head: true });\r\n    res.json({ usersCount: usersCount ?? 0 });\r\n  } catch (e) {\r\n    res.status(500).json({ error: 'Failed to load overview' });\r\n  }\r\n});\r\n\r\n// Start\r\napp.listen(PORT, () => {\r\n  logger.info({ port: PORT }, 'Admin API listening');\r\n});\r\n"],"mappings":"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","names":["pino","swaggerJSDoc","express","helmet","cors","rateLimit","swaggerUi","jwt"]}